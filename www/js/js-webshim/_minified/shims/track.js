jQuery.webshims.register("track",function(g,d,r,s){var i=d.mediaelement;(new Date).getTime();var u={subtitles:1,captions:1},m=Modernizr.ES5&&Modernizr.objectAccessor,p=function(a){var b={};a.addEventListener=function(a,e){b[a]&&d.error("always use $.bind to the shimed event: "+a+" already bound fn was: "+b[a]+" your fn was: "+e);b[a]=e};a.removeEventListener=function(a,e){b[a]&&b[a]!=e&&d.error("always use $.bind/$.unbind to the shimed event: "+a+" already bound fn was: "+b[a]+" your fn was: "+e);
b[a]&&delete b[a]};return a},v={getCueById:function(a){for(var b=null,f=0,e=this.length;f<e;f++)if(this[f].id===a){b=this[f];break}return b}},w={shimActiveCues:null,_shimActiveCues:null,activeCues:null,cues:null,kind:"subtitles",label:"",language:"",mode:"disabled",readyState:0,oncuechange:null,toString:function(){return"[object TextTrack]"},addCue:function(a){if(this.cues){var b=this.cues[this.cues.length-1];b&&b.startTime>a.startTime&&d.error("cue startTime higher than previous cue's startTime")}else this.cues=
i.createCueList();a.track&&d.error("cue already part of a track element");a.track=this;this.cues.push(a)},removeCue:function(){d.error("not implemented yet")},DISABLED:"disabled",OFF:"disabled",HIDDEN:"hidden",SHOWING:"showing",ERROR:3,LOADED:2,LOADING:1,NONE:0},n=["kind","label","srclang"],o={srclang:"language"},x=Function.prototype.call.bind(Object.prototype.hasOwnProperty),j=function(a,b){var f=[],e=[],c=[],h,k;a||(a=d.data(this,"mediaelementBase")||d.data(this,"mediaelementBase",{}));if(!b)a.blockTrackListUpdate=
!0,b=g.prop(this,"textTracks"),a.blockTrackListUpdate=!1;clearTimeout(a.updateTrackListTimer);g("track",this).each(function(){var a=g.prop(this,"track");c.push(a);-1==b.indexOf(a)&&e.push(a)});if(a.scriptedTextTracks)for(h=0,k=a.scriptedTextTracks.length;h<k;h++)c.push(a.scriptedTextTracks[h]),-1==b.indexOf(a.scriptedTextTracks[h])&&e.push(a.scriptedTextTracks[h]);for(h=0,k=b.length;h<k;h++)-1==c.indexOf(b[h])&&f.push(b[h]);if(f.length||e.length){b.splice(0);for(h=0,k=c.length;h<k;h++)b.push(c[h]);
for(h=0,k=f.length;h<k;h++)g([b]).triggerHandler(g.Event({type:"removetrack",track:b,track:f[h]}));for(h=0,k=e.length;h<k;h++)g([b]).triggerHandler(g.Event({type:"addtrack",track:b,track:e[h]}));(a.scriptedTextTracks||f.length)&&g(this).triggerHandler("updatetrackdisplay")}},t=function(a,b){var f,e;b||(b=d.data(a,"trackData"));if(b&&!b.isTriggering)b.isTriggering=!0,f=(b.track||{}).mode,e=(b.track||{}).kind,setTimeout(function(){if(f!==(b.track||{}).mode||e!=(b.track||{}).kind)(b.track||{}).readyState?
g(a).parent().triggerHandler("updatetrackdisplay"):g(a).triggerHandler("checktrackmode");b.isTriggering=!1},9)},q=g("<div />")[0];r.TextTrackCue=function(a,b,f){3!=arguments.length&&d.error("wrong arguments.length for TextTrackCue.constructor");this.startTime=a;this.endTime=b;this.text=f;this.id="";this.pauseOnExit=!1;p(this)};r.TextTrackCue.prototype={onenter:null,onexit:null,pauseOnExit:!1,getCueAsHTML:function(){var a="",b="",f=s.createDocumentFragment(),e;if(!x(this,"getCueAsHTML"))e=this.getCueAsHTML=
function(){var c,h;if(a!=this.text){a=this.text;b=i.parseCueTextToHTML(a);q.innerHTML=b;for(c=0,h=q.childNodes.length;c<h;c++)f.appendChild(q.childNodes[c].cloneNode(!0))}return f.cloneNode(!0)};return e?e.apply(this,arguments):f.cloneNode(!0)},track:null,id:""};i.createCueList=function(){return g.extend([],v)};i.parseCueTextToHTML=function(){var a=/(<\/?[^>]+>)/ig,b=/^(?:c|v|ruby|rt|b|i|u)/,f=/\<\s*\//,e=function(b,a,c,e){f.test(e)?b="</"+b+">":(c.splice(0,1),b="<"+b+" "+a+'="'+c.join(" ").replace(/\"/g,
"&#34;")+'">');return b},c=function(a){var c=a.replace(/[<\/>]+/ig,"").split(/[\s\.]+/);c[0]&&(c[0]=c[0].toLowerCase(),b.test(c[0])?"c"==c[0]?a=e("span","class",c,a):"v"==c[0]&&(a=e("q","title",c,a)):a="");return a};return function(b){return b.replace(a,c)}}();i.loadTextTrack=function(a,b,f,e){var c=f.track,h=function(){var e=g.prop(b,"src"),f,l;if("disabled"!=c.mode&&e&&g.attr(b,"src")&&(g(a).unbind("play playing timeupdate updatetrackdisplay",h),g(b).unbind("checktrackmode",h),!c.readyState)){f=
function(){c.readyState=3;c.cues=null;c.activeCues=c.shimActiveCues=c._shimActiveCues=null;g(b).triggerHandler("error")};c.readyState=1;try{c.cues=i.createCueList(),c.activeCues=c.shimActiveCues=c._shimActiveCues=i.createCueList(),l=g.ajax({dataType:"text",url:e,success:function(e){"text/vtt"!=l.getResponseHeader("content-type")&&d.error("set the mime-type of your WebVTT files to text/vtt. see: http://dev.w3.org/html5/webvtt/#text/vtt");i.parseCaptions(e,c,function(e){e&&"length"in e?(c.readyState=
2,g(b).triggerHandler("load"),g(a).triggerHandler("updatetrackdisplay")):f()})},error:f})}catch(j){f(),d.warn(j)}}};c.readyState=0;c.shimActiveCues=null;c._shimActiveCues=null;c.activeCues=null;c.cues=null;g(a).unbind("play playing timeupdate updatetrackdisplay",h);g(b).unbind("checktrackmode",h);g(a).bind("play playing timeupdate updatetrackdisplay",h);g(b).bind("checktrackmode",h);if(e)c.mode=u[c.kind]?"showing":"hidden",h()};i.createTextTrack=function(a,b){var f,e;if(b.nodeName&&(e=d.data(b,"trackData")))t(b,
e),f=e.track;if(!f)f=p(d.objectCreate(w)),m||n.forEach(function(a){var e=g.prop(b,a);e&&(f[o[a]||a]=e)}),b.nodeName?(m&&n.forEach(function(a){d.defineProperty(f,o[a]||a,{get:function(){return g.prop(b,a)}})}),e=d.data(b,"trackData",{track:f}),i.loadTextTrack(a,b,e,g.prop(b,"default"))):(m&&n.forEach(function(a){d.defineProperty(f,o[a]||a,{value:b[a],writeable:!1})}),f.cues=i.createCueList(),f.activeCues=f._shimActiveCues=f.shimActiveCues=i.createCueList(),f.mode="hidden",f.readyState=2);return f};
i.parseCaptionChunk=function(){var a=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,b=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,f=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,e=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g;return function(c){var h,d,g,i;if(b.exec(c)||f.exec(c)||e.exec(c))return null;for(c=c.split(/\n/g);!c[0].replace(/\s+/ig,"").length&&0<c.length;)c.shift();for(c[0].match(/^\s*[a-z0-9]+\s*$/ig)&&(g=""+c.shift().replace(/\s*/ig,""));0<c.length;){if(i=a.exec(c[0]))d=
i.slice(1),h=parseInt(3600*(d[0]||0),10)+parseInt(60*(d[1]||0),10)+parseInt(d[2]||0,10)+parseFloat("0."+(d[3]||0)),d=parseInt(3600*(d[4]||0),10)+parseInt(60*(d[5]||0),10)+parseInt(d[6]||0,10)+parseFloat("0."+(d[7]||0));c=c.slice(0,0).concat(c.slice(1));break}if(!h&&!d)return null;c=c.join("\n");h=new TextTrackCue(h,d,c);if(g)h.id=g;return h}}();i.parseCaptions=function(a,b,f){i.createCueList();var e,c,h,g,j;a?(h=/^WEBVTT(\s*FILE)?/ig,c=function(l,m){for(;l<m;l++){e=a[l];if(h.test(e))j=!0;else if(e.replace(/\s*/ig,
"").length){if(!j){d.error("please use WebVTT format. This is the standard");f(null);break}(e=i.parseCaptionChunk(e,l))&&b.addCue(e)}if(g<(new Date).getTime()-9){l++;setTimeout(function(){g=(new Date).getTime();c(l,m)},90);break}}l>=m&&(j||d.error("please use WebVTT format. This is the standard"),f(b.cues))},a=a.replace(/\r\n/g,"\n"),setTimeout(function(){a=a.replace(/\r/g,"\n");setTimeout(function(){g=(new Date).getTime();a=a.split(/\n\n+/g);c(0,a.length)},9)},9)):d.error("Required parameter captionData not supplied.")};
i.createTrackList=function(a,b){b=b||d.data(a,"mediaelementBase")||d.data(a,"mediaelementBase",{});if(!b.textTracks)b.textTracks=[],d.defineProperties(b.textTracks,{onaddtrack:{value:null},onremovetrack:{value:null}}),p(b.textTracks);return b.textTracks};Modernizr.track||(d.defineNodeNamesBooleanProperty(["track"],"default"),d.reflectProperties(["track"],["srclang","label"]),d.defineNodeNameProperties("track",{src:{reflect:!0,propType:"src"}}));d.defineNodeNameProperties("track",{kind:{attr:Modernizr.track?
{set:function(a){var b=d.data(this,"trackData");this.setAttribute("data-kind",a);if(b)b.attrKind=a},get:function(){var a=d.data(this,"trackData");return a&&"attrKind"in a?a.attrKind:this.getAttribute("kind")}}:{},reflect:!0,propType:"enumarated",defaultValue:"subtitles",limitedTo:["subtitles","captions","descriptions","chapters","metadata"]}});m||g.each(n,function(a,b){var f=o[b]||b;d.onNodeNamesPropertyModify("track",b,function(){var a=d.data(this,"trackData");a&&(a.track[f]=g.prop(this,b),t(this,
a))})});d.onNodeNamesPropertyModify("track","src",function(a){if(a){var a=d.data(this,"trackData"),b;a&&(b=g(this).closest("video, audio"),b[0]&&i.loadTextTrack(b,this,a))}});d.defineNodeNamesProperties(["track"],{ERROR:{value:3},LOADED:{value:2},LOADING:{value:1},NONE:{value:0},readyState:{get:function(){return(g.prop(this,"track")||{readyState:0}).readyState},writeable:!1},track:{get:function(){return i.createTextTrack(g(this).closest("audio, video")[0],this)},writeable:!1}},"prop");d.defineNodeNamesProperties(["audio",
"video"],{textTracks:{get:function(){var a=d.data(this,"mediaelementBase")||d.data(this,"mediaelementBase",{}),b=i.createTrackList(this,a);a.blockTrackListUpdate||j.call(this,a,b);return b},writeable:!1},addTextTrack:{value:function(a,b,f){a=i.createTextTrack(this,{kind:a||"",label:b||"",srclang:f||""});b=d.data(this,"mediaelementBase")||d.data(this,"mediaelementBase",{});if(!b.scriptedTextTracks)b.scriptedTextTracks=[];b.scriptedTextTracks.push(a);j.call(this);return a}}},"prop");g(s).bind("emptied ended updatetracklist",
function(a){if(g(a.target).is("audio, video")){var b=d.data(a.target,"mediaelementBase");if(b)clearTimeout(b.updateTrackListTimer),b.updateTrackListTimer=setTimeout(function(){j.call(a.target,b)},0)}});d.addReady(function(a,b){var f=b.filter("video, audio, track").closest("audio, video");g("video, audio",a).add(f).each(function(){j.call(this)}).each(function(){if(Modernizr.track){var a=this.textTracks;g.prop(this,"textTracks").length!=a.length&&d.error("textTracks couldn't be copied");g("track",this).each(function(){var a=
g.prop(this,"track"),b=this.track,d,e;if(b){d=g.prop(this,"kind");e=b.readyState||this.readyState;if(b.mode||e)a.mode=b.mode;if("descriptions"!=d)b.mode="string"==typeof b.mode?"disabled":0,this.kind="metadata",g(this).attr({kind:d})}}).bind("load error",function(a){a.originalEvent&&a.stopImmediatePropagation()})}});f.each(function(){var a=this,b=d.data(a,"mediaelementBase");if(b)clearTimeout(b.updateTrackListTimer),b.updateTrackListTimer=setTimeout(function(){j.call(a,b)},9)})});Modernizr.track&&
g("video, audio").trigger("trackapichange")});
